angular.module("beehrm",["ionic","ngCordova","ngStorage","ngFx","ngAnimate","ionic-datepicker","beehrm.directives","beehrm.services","beehrm.factories","beehrm.controllers"]).constant("urls",{BASE_API:"http://youngminds.com.np/beehrm_mobile/"}).run(["$ionicPlatform",function(e){e.ready(function(){window.plugins&&(window.plugins.nativepagetransitions.globalOptions.duration=400,window.plugins.nativepagetransitions.globalOptions.iosdelay=250,window.plugins.nativepagetransitions.globalOptions.androiddelay=250,window.plugins.nativepagetransitions.globalOptions.winphonedelay=250,window.plugins.nativepagetransitions.globalOptions.slowdownfactor=4,window.plugins.nativepagetransitions.globalOptions.fixedPixelsTop=0,window.plugins.nativepagetransitions.globalOptions.fixedPixelsBottom=0),window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.backgroundColorByHexString("#445963")})}]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider","$httpProvider",function(e,t,o,n){e.state("app",{url:"/app","abstract":!0,templateUrl:"templates/menu.html",controller:"AppCtrl"}).state("app.access",{url:"/access",views:{menuContent:{templateUrl:"templates/access.html"}}}).state("app.login",{url:"/login",views:{menuContent:{templateUrl:"templates/login.html",controller:"LoginCtrl"}}}).state("app.events",{url:"/events",views:{menuContent:{templateUrl:"templates/events.html",controller:"EventsCtrl"}}}).state("app.notifications",{url:"/notifications",views:{menuContent:{templateUrl:"templates/notifications.html",controller:"NotificationsCtrl"}}}).state("app.leaves",{url:"/leaves",views:{menuContent:{templateUrl:"templates/leaves.html",controller:"LeavesCtrl"}}}).state("app.leavesBalance",{url:"/leaves-balance",views:{menuContent:{templateUrl:"templates/leaves.balance.html"}}}).state("app.leave",{url:"/leaves/:leaveId",views:{menuContent:{templateUrl:"templates/leave.html",controller:"LeaveCtrl"}}}).state("app.bulletinBoard",{url:"/bulletinBoards/:bulletinId",views:{menuContent:{templateUrl:"templates/bulletin.html",controller:"BulletinBoardCtrl"}}}).state("app.payslips",{url:"/payslips",views:{menuContent:{templateUrl:"templates/payslips.html",controller:"PayslipsCtrl"}}}).state("app.payslip",{url:"/payslips/:slipId",views:{menuContent:{templateUrl:"templates/payslip.html",controller:"PayslipCtrl"}}}).state("app.dashboard",{url:"/dashboard",views:{menuContent:{templateUrl:"templates/dashboard.html",controller:"DashboardCtrl"}}}),t.otherwise("/app/access"),o.tabs.position("bottom"),o.navBar.alignTitle("center"),o.views.transition("platform"),o.scrolling.jsScrolling("false"),o.views.transition("none"),n.interceptors.push(["$q","$location","$localStorage",function(e,t,o){return{request:function(e){return e.headers=e.headers||{},o.token&&(e.headers.Authorization="Bearer "+o.token),e},responseError:function(o){return 401===o.status?t.path("/app/login"):403===o.status&&t.path("/app/access"),e.reject(o)}}}])}]),angular.module("beehrm.services",[]).service("Navigation",["$state","$ionicPlatform",function(e,t){this.goNative=function(e,o){t.ready(function(){switch(o){case"slide":window.plugins.nativepagetransitions.slide({direction:e},function(e){console.log("success: "+e)},function(e){});break;case"flip":window.plugins.nativepagetransitions.flip({direction:e},function(e){console.log("success: "+e)},function(e){});break;case"fade":window.plugins.nativepagetransitions.fade({},function(e){console.log("success: "+e)},function(e){});break;case"drawer":window.plugins.nativepagetransitions.drawer({origin:e,action:"open"},function(e){console.log("success: "+e)},function(e){});break;case"curl":window.plugins.nativepagetransitions.curl({direction:e},function(e){console.log("success: "+e)},function(e){});break;default:window.plugins.nativepagetransitions.slide({direction:e},function(e){console.log("success: "+e)},function(e){})}})}}]),angular.module("beehrm.factories",[]).factory("Auth",["$http","$localStorage","urls",function(e,t,o){return{access:function(t){return e({url:o.BASE_API,method:"POST",dataType:"json",data:t,headers:{"Content-Type":"application/json"}})},login:function(o){var n=t.accessData.org_app_url;return e({url:n+"/login",method:"POST",dataType:"json",data:o,headers:{"Content-Type":"application/x.vdn.v1+json"}})},logout:function(e){delete t.token,delete t.userInfo,delete t.notifications,delete t.payslip,delete t.bulletinBoard,e()}}}]).factory("Me",["$http","$localStorage","urls",function(e,t,o){return{basic:function(o){var n=t.accessData.org_app_url;return e({url:n+"/me",method:"GET",dataType:"json",headers:{"Content-Type":"application/x.vdn.v1+json",Authorization:"bearer "+t.token}})},include:function(o){var n=t.accessData.org_app_url,a="";return angular.forEach(o,function(e,t){a+=e+","}),included=a.substring(0,a.length-1),a="undefined"==typeof included?"":included,e({url:n+"/me?include="+a,method:"GET",dataType:"json",headers:{"Content-Type":"application/x.vdn.v1+json",Authorization:"bearer "+t.token}})}}}]).factory("All",["$http","$localStorage","urls",function(e,t,o){return{leaveApplication:function(o){var n=t.accessData.org_app_url,a="undefined"==typeof o[0]?"":o[0];return e({url:n+"/leave-application/?"+a,method:"GET",dataType:"json",headers:{"Content-Type":"application/x.vdn.v1+json",Authorization:"bearer "+t.token}})},bulletinBoard:function(o){var n=t.accessData.org_app_url;return e({url:n+"/bulletin-board",method:"GET",dataType:"json",headers:{"Content-Type":"application/x.vdn.v1+json",Authorization:"bearer "+t.token}})}}}]),angular.module("beehrm.directives",[]).directive("goNative",["Navigation",function(e){return{restrict:"A",link:function(t,o,n){var a=n.direction,i=n.transitiontype;t.$on("$stateChangeStart",function(){e.goNative(a,i)})}}}]).directive("showFooter",["$rootScope",function(e){return{restrict:"A",link:function(t,o){e.showFooter||(t.$on("$ionicView.beforeEnter",function(){e.showFooter=!0}),t.$on("$stateChangeStart",function(){e.showFooter=!1}))}}}]).directive("showTabs",["$rootScope",function(e){return{restrict:"A",link:function(t,o){e.showTabs||(t.$on("$ionicView.beforeEnter",function(){e.showTabs=!0}),t.$on("$stateChangeStart",function(){e.showTabs=!1}))}}}]).directive("showLeaveFooter",["$rootScope",function(e){return{restrict:"A",link:function(t,o){e.showLeaveFooter||(t.$on("$ionicView.beforeEnter",function(){e.showLeaveFooter=!0}),t.$on("$stateChangeStart",function(){e.showLeaveFooter=!1}))}}}]).directive("showLeaveTabs",["$rootScope",function(e){return{restrict:"A",link:function(t,o){e.showLeaveTabs||(t.$on("$ionicView.beforeEnter",function(){e.showLeaveTabs=!0}),t.$on("$stateChangeStart",function(){e.showLeaveTabs=!1}))}}}]),angular.module("beehrm.controllers",[]).controller("AppCtrl",["$scope","$rootScope","$state","$timeout","$localStorage","$ionicSideMenuDelegate","$ionicLoading","$ionicHistory","$cordovaDialogs","$cordovaNetwork","Auth",function(e,t,o,n,a,i,l,s,r,c,p){l.show({template:"Loading..."}),e.$on("$ionicView.enter",function(){i.canDragContent(!1)}),e.$on("$ionicView.leave",function(){i.canDragContent(!0)}),e.isOnline=c.isOnline(),t.$on("$cordovaNetwork:online",function(t,o){e.isOnline=!0}),t.$on("$cordovaNetwork:offline",function(t,o){e.isOnline=!1}),"undefined"!=typeof a.token?(e.userInfo=a.userInfo,o.go("app.dashboard",{},{reload:!0})):"undefined"!=typeof a.accessData?o.go("app.login",{},{reload:!0}):e.accessShow=!0,n(function(){l.hide()},1e3),e.accessData={},e.access=function(){e.isOnline?(l.show({template:"Loading..."}),p.access({org_key:e.accessData.orgKey}).success(function(t){e.accessShow=!1,a.accessData=t,l.hide(),o.go("app.login")}).error(function(e){n(function(){l.hide(),r.alert(e.message,"Whoops","OK")},1e3)})):r.alert("Please check your internet connection","Whoops","OK")},e.logout=function(){l.show({template:"Loading..."}),p.logout(function(){n(function(){s.clearCache(),s.clearHistory(),e.loginShow=!0,o.go("app.login"),l.hide()},1e3)})}}]).controller("LoginCtrl",["$scope","$rootScope","$state","$timeout","$localStorage","$ionicLoading","$cordovaDialogs","$cordovaNetwork","Auth","Me","All",function(e,t,o,n,a,i,l,s,r,c,p){function u(){c.include({0:"applications",1:"payslip"}).success(function(t){a.notifications=t.data.notifications,delete t.data.notifications,a.userInfo=t.data,e.userInfo=a.userInfo,d()}).error(function(e){n(function(){i.hide(),l.alert(e.message,"Whoops","OK")},1e3)})}function d(){p.bulletinBoard({}).success(function(e){a.bulletinBoard=e.data,o.go("app.dashboard"),i.hide()}).error(function(e){n(function(){i.hide(),l.alert(e.message,"Whoops","OK")},1e3)})}i.show({template:"Loading..."}),e.isOnline=s.isOnline(),t.$on("$cordovaNetwork:online",function(t,o){e.isOnline=!0,"undefined"!=typeof a.token&&(i.show({template:"Syncing data..."}),d())}),t.$on("$cordovaNetwork:offline",function(t,o){e.isOnline=!1}),n(function(){"undefined"!=typeof a.token?(e.userInfo=a.userInfo,e.isOnline?d():o.go("app.dashboard")):e.loginShow=!0,i.hide()},1e3),e.loginData={},e.login=function(){e.isOnline?(i.show({template:"Loading..."}),r.login({email:e.loginData.email,password:e.loginData.password}).success(function(t){e.loginShow=!1,a.token=t.token,u()}).error(function(e){n(function(){i.hide(),l.alert(e.message,"Whoops","OK")},1e3)})):l.alert("Please check your internet connection","Whoops","OK")}}]).controller("DashboardCtrl",["$scope","$rootScope","$localStorage","$cordovaDialogs",function(e,t,o,n){e.userInfo=o.userInfo,t.bulletinBoard=o.bulletinBoard,e.checkIn=function(){n.alert("This section will be activated soon","Sorry :(","OK")}}]).controller("NotificationsCtrl",["$scope","$state","$localStorage","Me",function(e,t,o,n){e.notifications=o.notifications.data,e.doRefresh=function(){n.include({}).success(function(t){delete o.notifications,o.notifications=t.data.notifications,e.notifications=t.data.notifications.data,e.$broadcast("scroll.refreshComplete")}).error(function(e){$timeout(function(){$ionicLoading.hide(),$cordovaDialogs.alert(e.message,"Whoops","OK").then(function(){401==e.status_code&&(delete o.token,t.go("app.login"))})},1e3)})}}]).controller("EventsCtrl",["$scope",function(e){e.items=[{title:"बाबुको मुख हेर्ने दिन - भाद्र २७, आइतवार",day:"13",month:"Sep",id:1},{title:"दर खाने - भाद्र २९, मङ्गलवार",status:"P",day:"15",month:"Sep",id:2},{title:"ऋषिपञ्चमी व्रत - आश्विन १, शुक्रवार",status:"A",day:"18",month:"Sep",id:3},{title:"घटस्थापना - आश्विन २६, मङ्गलवार",status:"A",day:"13",month:"Oct",id:4},{title:"फूलपाती - कार्तिक ३, मङ्गलवार",status:"A",day:"20",month:"Oct",id:5},{title:"कालरात्री - कार्तिक ४, बुधवार",status:"R",day:"21",month:"Oct",id:6},{title:"महाअष्टमी - कार्तिक ४, बुधवार",status:"A",day:"22",month:"Oct",id:7},{title:"विजया दशमी - कार्तिक ५, बिहिवार",status:"R",day:"22",month:"Oct",id:8},{title:"काग तिहार - कार्तिक २३, सोमवार",status:"A",day:"09",month:"Nov",id:9},{title:"कुकुर तिहार - कार्तिक २४, मङ्गलवार",status:"A",day:"10",month:"Nov",id:10}]}]).controller("LeavesCtrl",["$scope","$rootScope","$state","$localStorage","$timeout","$cordovaNetwork","$ionicLoading","$cordovaDialogs","All",function(e,t,o,n,a,i,l,s,r){function c(){r.leaveApplication({}).success(function(o){delete n.userInfo.applications,n.userInfo.applications=o,t.applications=n.userInfo.applications.data,e.total_pages=o.meta.pagination.total_pages,e.current_page=o.meta.pagination.current_page,e.leavesShow=!0,l.hide(),a(function(){e.total_pages!=e.current_page&&(e.moreDataCanBeLoaded=function(){return!0})},1e3)}).error(function(e){a(function(){l.hide(),s.alert(e.message,"Whoops","OK").then(function(){401==e.status_code&&(delete n.token,o.go("app.login"),console.log("i m here"))})},1e3)}),e.loadMore=function(){var i=parseInt(e.current_page)+1;r.leaveApplication({0:"page="+i}).success(function(o){a(function(){e.total_pages=o.meta.pagination.total_pages,e.current_page=o.meta.pagination.current_page,e.total_pages==e.current_page&&(e.moreDataCanBeLoaded=function(){return!1}),t.applications=t.applications.concat(o.data),e.$broadcast("scroll.infiniteScrollComplete")},1e3)}).error(function(e){a(function(){l.hide(),s.alert(e.message,"Whoops","OK").then(function(){401==e.status_code&&(delete n.token,o.go("app.login"))})},1e3)})}}e.leavesShow=!1,l.show({template:"Loading..."}),e.moreDataCanBeLoaded=function(){return!1},e.isOffline=i.isOffline(),t.$on("$cordovaNetwork:online",function(t,o){e.isOffline=!1,l.show({template:"Syncing data..."}),c()}),t.$on("$cordovaNetwork:offline",function(t,o){e.isOffline=!0}),e.isOffline?a(function(){t.applications=n.userInfo.applications.data,e.leavesShow=!0,l.hide()},1e3):c()}]).controller("LeaveCtrl",["$scope","$rootScope","$state","$ionicLoading","$timeout","$localStorage","$stateParams","$filter","$cordovaDialogs",function(e,t,o,n,a,i,l,s,r){function c(e){var o=s("filter")(t.applications,{id:e});return o.length?o[0]:"NOTFOUND"}e.leaveShow=!1,n.show({template:"Loading..."});var p=l.leaveId,u=c(p);a(function(){n.hide(),"NOTFOUND"==u?r.alert("Something went wrong","Whoops","OK").then(function(){o.go("app.leaves")}):(e.leaveDetails=u,e.leaveShow=!0)},1e3)}]).controller("BulletinBoardCtrl",["$scope","$rootScope","$state","$ionicLoading","$timeout","$localStorage","$stateParams","$filter","$cordovaDialogs",function(e,t,o,n,a,i,l,s,r){function c(e){var o=s("filter")(t.bulletinBoard,{id:e});return o.length?o[0]:"NOTFOUND"}e.bulletinShow=!1,n.show({template:"Loading..."});var p=l.bulletinId,u=c(p);a(function(){n.hide(),"NOTFOUND"==u?r.alert("Something went wrong","Whoops","OK").then(function(){o.go("app.dashboard")}):(e.bulletinDetails=u,e.bulletinShow=!0)},1e3)}]).controller("ApplyLeaveCtrl",["$scope","$ionicModal","$timeout","$cordovaDialogs",function(e,t,o,n){e.expandText=function(){var e=document.getElementById("txtnotes");e.style.height=e.scrollHeight+"px"},e.options=[{name:"Paid",id:1},{name:"Unpaid",id:2}],e.leaveData={leaveType:e.options[1]},t.fromTemplateUrl("templates/leave.apply.html",{scope:e}).then(function(t){e.modal=t}),e.closeLeave=function(){e.modal.hide()},e.applyLeave=function(){n.alert("This section will be activated soon","Sorry :(","OK")},e.doLeave=function(){console.log("Doing leave",e.leaveData),o(function(){e.closeLeave()},1e3)},e.startDatepickerObject={titleLabel:"Select Date",todayLabel:"Today",closeLabel:"Close",setLabel:"Set",setButtonType:"button-balanced button-outline",todayButtonType:"button-balanced button-outline",closeButtonType:"button-balanced button-outline",mondayFirst:!0,templateType:"popup",modalHeaderColor:"bar-primary",modalFooterColor:"bar-primary",callback:function(e){a(e)}},e.startDate=new Date;var a=function(t){"undefined"==typeof t?console.log("No date selected"):(e.startDate=t,console.log("Selected date is : ",t))};e.endDatepickerObject={titleLabel:"Select Date",todayLabel:"Today",closeLabel:"Close",setLabel:"Set",setButtonType:"button-balanced button-outline",todayButtonType:"button-balanced button-outline",closeButtonType:"button-balanced button-outline",mondayFirst:!0,templateType:"popup",modalHeaderColor:"bar-primary",modalFooterColor:"bar-primary",callback:function(e){i(e)}},e.endDate=new Date;var i=function(t){"undefined"==typeof t?console.log("No date selected"):(e.endDate=t,console.log("Selected date is : ",t))}}]).controller("PayslipsCtrl",["$scope","$rootScope","$state","$ionicLoading","$timeout","$localStorage","$cordovaNetwork","$cordovaDialogs","Me",function(e,t,o,n,a,i,l,s,r){function c(){r.include({0:"payslip"}).success(function(o){i.payslip=o.data.payslip.data,t.payslip=i.payslip,e.payslipsShow=!0,n.hide()}).error(function(e){a(function(){n.hide(),s.alert(e.message,"Whoops","OK").then(function(){401==e.status_code&&(delete i.token,o.go("app.login"))})},1e3)})}e.payslipsShow=!1,n.show({template:"Loading..."}),t.$on("$cordovaNetwork:online",function(e,t){n.show({template:"Syncing data..."}),c()});var p=l.isOffline();p?a(function(){t.payslip=i.payslip,e.payslipsShow=!0,n.hide()},1e3):c()}]).controller("PayslipCtrl",["$scope","$rootScope","$state","$ionicLoading","$timeout","$localStorage","$stateParams","$filter","$cordovaDialogs",function(e,t,o,n,a,i,l,s,r){function c(e){var o=s("filter")(t.payslip,{id:e});return o.length?o[0]:"NOTFOUND"}e.payslipShow=!1,n.show({template:"Loading..."});var p=l.slipId,u=c(p);a(function(){n.hide(),"NOTFOUND"==u?r.alert("Something went wrong","Whoops","OK").then(function(){o.go("app.payslips")}):(e.payslipDetails=u,e.payslipShow=!0)},1e3)}]);